<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A page with notes about Android"><meta name=author content=irubenboy><link href=https://irubenboy.github.io/android/bloque_i/tema_2/page-6/ rel=canonical><link href=../page-5/ rel=prev><link href=../page-7/ rel=next><link rel=icon href=../../../assets/icon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>6 Gestión en Android - Android</title><link rel=stylesheet href=../../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../extra/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#6-gestion-en-android class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=Android class="md-header__button md-logo" aria-label=Android data-md-component=logo> <img src=../../../assets/icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Android </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 6 Gestión en Android </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/irubenboy/android title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> irubenboy/android </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../tema_1/page-1/ class="md-tabs__link md-tabs__link--active"> Bloque I </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Android class="md-nav__button md-logo" aria-label=Android data-md-component=logo> <img src=../../../assets/icon.png alt=logo> </a> Android </label> <div class=md-nav__source> <a href=https://github.com/irubenboy/android title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> irubenboy/android </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_1 type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1 tabindex=0 aria-expanded=true> Bloque I <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Bloque I" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Bloque I </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_1_1 type=checkbox id=__nav_1_1> <label class=md-nav__link for=__nav_1_1 tabindex=0 aria-expanded=false> Tema 1 - Introducción a la programación Android <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Tema 1 - Introducción a la programación Android" data-md-level=2> <label class=md-nav__title for=__nav_1_1> <span class="md-nav__icon md-icon"></span> Tema 1 - Introducción a la programación Android </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tema_1/page-1/ class=md-nav__link> 1 Instalación del entorno de desarrollo </a> </li> <li class=md-nav__item> <a href=../../tema_1/page-2/ class=md-nav__link> 2 Primera Aplicación </a> </li> <li class=md-nav__item> <a href=../../tema_1/page-3/ class=md-nav__link> 3 View </a> </li> <li class=md-nav__item> <a href=../../tema_1/page-4/ class=md-nav__link> 4 Recursos y la Clase R </a> </li> <li class=md-nav__item> <a href=../../tema_1/page-5/ class=md-nav__link> 5 ViewBinding </a> </li> <li class=md-nav__item> <a href=../../tema_1/page-6/ class=md-nav__link> 6 Recursos de valores </a> </li> <li class=md-nav__item> <a href=../../tema_1/page-7/ class=md-nav__link> 7 Clase Resources </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_1_2 type=checkbox id=__nav_1_2 checked> <label class=md-nav__link for=__nav_1_2 tabindex=0 aria-expanded=true> Tema 2 - Vistas básicas <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Tema 2 - Vistas básicas" data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Tema 2 - Vistas básicas </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../page-1/ class=md-nav__link> 1 Introducción a las vistas básicas </a> </li> <li class=md-nav__item> <a href=../page-2/ class=md-nav__link> 2 Oyentes y cadenas </a> </li> <li class=md-nav__item> <a href=../page-3/ class=md-nav__link> 3 Botones compuestos </a> </li> <li class=md-nav__item> <a href=../page-4/ class=md-nav__link> 4 Otras Vistas </a> </li> <li class=md-nav__item> <a href=../page-5/ class=md-nav__link> 5 Entorno de Android </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 6 Gestión en Android <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 6 Gestión en Android </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#gestion-del-foco class=md-nav__link> Gestión del foco </a> </li> <li class=md-nav__item> <a href=#gestion-del-teclado-virtual class=md-nav__link> Gestión del teclado Virtual </a> </li> <li class=md-nav__item> <a href=#imeoptions class=md-nav__link> ImeOptions </a> </li> <li class=md-nav__item> <a href=#gestion-de-la-escritura class=md-nav__link> Gestión de la escritura </a> </li> <li class=md-nav__item> <a href=#fijar-la-orientacion-de-la-actividad class=md-nav__link> Fijar la orientación de la actividad </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../page-7/ class=md-nav__link> Proyecto TIME </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=6-gestion-en-android>6 Gestión en Android<a class=headerlink href=#6-gestion-en-android title="Permanent link">&para;</a></h1> <h2 id=gestion-del-foco>Gestión del foco<a class=headerlink href=#gestion-del-foco title="Permanent link">&para;</a></h2> <p>Android nos da la posibilidad de gestionar el foco en la interfaz de usuario de nuestra actividad.</p> <div class="admonition note"> <p class=admonition-title>Foco</p> <p>El foco hace referencia cuál de las vistas de la interfaz de usuario presente en pantalla recibirá en ese momento los eventos de entrada de datos ventanas que produzca el usuario desde un dispositivo de entrada, normalmente el teclado. En un momento dado sólo una vista puede tener el foco.</p> </div> <p>Para que el usuario tenga una referencia visual de qué vista tiene el foco en cada momento, ésta suele mostrar algún tipo de clave visual, dependiendo del tipo de vista de la que se trate. Por ejemplo, en el caso de la vista <code>EditText</code>, la línea inferior se muestra de diferente color y aparece el cursor dentro de ella.</p> <p>Por defecto cualquier vista puede recibir el foco. Sin embargo, podemos cambiar este comportamiento estableciendo en la vista correspondiente el atributo <code>android:focusable="false"</code>. Algunos subtipos de vistas definen este valor directamente a <code>false</code>, por lo que en la mayoría de las ocasiones no es necesario establecerlo explícitamente.</p> <p>La clase <code>View</code> proporciona una serie de atributos XML y métodos para gestionar el foco:</p> <figure> <p><img alt="Clase View" src=../res/esquema15.svg> <figcaption>Figura 18 - Clase View</figcaption></p> </figure> <p>En un <em>layout</em> con distintas vistas el foco irá pasando de una vista a otra conforme el usuario introduzca los datos o interactúe con las mismas. El sistema asignará por defecto un determinado orden de foco entre las vistas del <em>layout</em>, atendiendo a su posición en el mismo, siguiendo una estrategia de izquierda a derecha y, posteriormente, de arriba a abajo.</p> <p>La mayoría de las veces dicho orden será el esperado, por lo que no tendremos que preocuparnos por ello. Sin embargo, en algunas ocasiones es necesario establecer un orden distinto al predefinido por el sistema. En ese caso Android nos permite establecer para las vistas los atributos <code>android:nextFocusDown</code>, <code>android:nextFocusLeft</code>, <code>android:nextFocusRight</code> y <code>android:nextFocusUp</code>, que recibirán el <code>id</code> de la vista a la que se debe dirigir el foco, dependiendo de la dirección que se pretenda seguir.</p> <p>Otro aspecto interesante es qué vista debe obtener el foco inicialmente cuando se muestra un <em>layout</em>. Para indicarla, podemos hacerlo en la propia especificación XML de <em>layout</em>, incluyendo dentro de dicha vista la etiqueta <code>&lt;requestFocus /&gt;</code>, como vemos en el siguiente ejemplo:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nt>&lt;EditText</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=na>android:id=</span><span class=s>&quot;@+id/txtUsername&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=na>android:layout_height=</span><span class=s>&quot;wrap_content&quot;</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=na>android:hint=</span><span class=s>&quot;@string/main_txtUsername&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span><span class=nt>&lt;requestFocus/&gt;</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=nt>&lt;/EditText&gt;</span>
</code></pre></div> <p>Por otra parte, si lo queremos es forzar a que una determinada vista obtenga en foco en base a algún evento que se ha producido, entonces desde código Java o Kotlin deberemos llamar al método <code>requestFocus()</code> de dicha vista.</p> <p>Modifiquemos entonces nuestro Proyecto Login para establecer el cuadro de texto correspondiente al nombre de usuario como vista que debe obtener inicialmente el foco. Así, el <em>layout</em> de nuestra actividad <code>res/layout/activity_main.xml</code> quedaría:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nt>&lt;LinearLayout</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>    </span><span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=na>android:id=</span><span class=s>&quot;@+id/llRoot&quot;</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=na>android:layout_height=</span><span class=s>&quot;match_parent&quot;</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=na>android:orientation=</span><span class=s>&quot;vertical&quot;</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=na>android:padding=</span><span class=s>&quot;@dimen/main_margin&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=cm>&lt;!-- ... --&gt;</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=nt>&lt;EditText</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>        </span><span class=na>android:id=</span><span class=s>&quot;@+id/txtUsername&quot;</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>        </span><span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>        </span><span class=na>android:layout_height=</span><span class=s>&quot;wrap_content&quot;</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>        </span><span class=na>android:hint=</span><span class=s>&quot;@string/main_txtUsername&quot;</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>        </span><span class=na>android:inputType=</span><span class=s>&quot;text&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>        </span><span class=nt>&lt;requestFocus</span><span class=w> </span><span class=nt>/&gt;</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>    </span><span class=nt>&lt;/EditText&gt;</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>    </span><span class=cm>&lt;!-- ... --&gt;</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=nt>&lt;/LinearLayout&gt;</span>
</code></pre></div> <p>Por otro lado, en algunas ocasiones queremos realizar algún tipo de tarea cuando una determinada vista obtiene o pierde el foco. Para estos casos deberemos crear un objeto <em>listener</em> que implemente la interfaz <code>View.OnFocusChangeListener</code> y asignárselo a la vista correspondiente mediante el método <code>setOnFocusChangeListener(onFocusChangeListener)</code>. Cuando la vista gane o pierda el foco el sistema llamará al método <code>onFocusChange(view, hasFocus)</code>, pasándole, además de la vista, si la vista ha quedado en posesión del foco o no. Veamos un ejemplo:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1>// Al perder o ganar el foco.</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>OnFocusChangeListener</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onFocusChange</span><span class=p>(</span><span class=n>View</span><span class=w> </span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>hasFocus</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>        </span><span class=c1>// ...</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=p>});</span>
</code></pre></div> <p>Al tratarse de una interfaz funcional (SAM, <em>single abstract method</em>), podemos usar también expresiones <em>lambda</em>, en vez de un objeto de una clase anónima inline.</p> <p>Debemos tener en cuenta que este <em>listener</em>, se dispara no sólo cuando el usuario interactúa con la aplicación, sino también cuando desde código se hace que la vista tome el foco.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Cuando se produce un cambio de configuración (como estudiaremos más adelante), el sistema preserva automáticamente una referencia a qué vista tenía el foco en ese momento, de manera que cuando la actividad vuelve a estar disponible, el sistema hace que dicha vista vuelva a tener el foco llamando a <code>requestFocus()</code>. Como consecuencia si para ese momento ya hemos establecido un <code>OnFocusChangeListener</code> para la vista, su código será ejecutado.</p> <p>Por este motivo los <em>listener</em> que reaccionan a la entrada de datos, como <code>OnFocusChangeListener</code>, <code>TextWatcher</code> en los <em>EditText</em>, <code>OnCheckChangedListener</code> de <em>CheckBox</em>, o similares, deben ser asociados a la vista correspondiente en el método <code>onStart()</code> de la actividad, y no en el método <code>onCreate()</code> para que su código no sea ejecutado automáticamente cuando se restaure el estado. Después, en el método <code>onStop()</code> deberemos quitar la asociación del <em>listener</em> con la vista.</p> <p>Sin embargo, los <em>listeners</em> que tan sólo reaccionan a la interacción del usuario, como por ejemplo <code>OnClickListener</code>no tienen este problema, por lo que podremos asignárselos a la vista en el método <code>onCreate()</code> de la actividad</p> </div> <p>Así, modifiquemos el código de nuestro Proyecto Login para que cuando un <code>EditText</code> coja el foco, el texto de su <code>TextView</code> acompañante cambie de color, tomando el color representado por el recurso de color <code>colorAccent</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MainActivity</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AppCompatActivity</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=c1>// ...</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setupViews</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>        </span><span class=c1>// ...</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>        </span><span class=n>changeColor</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=na>lblUsername</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>);</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onStart</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onStart</span><span class=p>();</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>((</span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>                </span><span class=n>changeColor</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=na>lblUsername</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>));</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>((</span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>                </span><span class=n>changeColor</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=na>lblPassword</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>));</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onStop</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onStop</span><span class=p>();</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>changeColor</span><span class=p>(</span><span class=n>TextView</span><span class=w> </span><span class=n>textView</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>hasFocus</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>colorResId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hasFocus</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>color</span><span class=p>.</span><span class=na>colorAccent</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>R</span><span class=p>.</span><span class=na>color</span><span class=p>.</span><span class=na>colorPrimaryText</span><span class=p>;</span>
<a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=w>        </span><span class=n>textView</span><span class=p>.</span><span class=na>setTextColor</span><span class=p>(</span><span class=n>ContextCompat</span><span class=p>.</span><span class=na>getColor</span><span class=p>(</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>colorResId</span><span class=p>));</span>
<a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a>
<a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isValidForm</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>isValidUserName</span><span class=p>(</span><span class=n>username</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>requestFocus</span><span class=p>();</span>
<a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>isValidPassword</span><span class=p>(</span><span class=n>password</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>requestFocus</span><span class=p>();</span>
<a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a>
<a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a><span class=p>}</span>
</code></pre></div> <p>En el código anterior usamos el método estático <code>ContextCompat.getColor(context, colorResId)</code> para obtener el color correspondiente. Esta es la forma recomendada para obtener el color correspondiente a un recurso de color, frente al empleo del método <code>getResources().getColor(colorResId)</code>, que ha sido marcado como <em>deprecated</em> (obsoleto).</p> <p>Otro ajuste que hemos tenido que hacer en el código anterior es establecer inicialmente el color adecuado para la vista <code>lblUsername</code>, ya que inicialmente <code>txtUsername</code> cogerá el foco, antes de que se haya establecido el <em>listener</em>.</p> <p>Finalmente, hemos modificado el proceso de validación de manera que si no es posible hacer login porque no se han introducido todos los valores obligatorios la primera vista correspondiente vuelva a obtener el foco, perdiéndolo el botón sobre el que había pulsado el usuario.</p> <h2 id=gestion-del-teclado-virtual>Gestión del teclado Virtual<a class=headerlink href=#gestion-del-teclado-virtual title="Permanent link">&para;</a></h2> <p>Cuando un <code>EditText</code> toma el foco por interacción del usuario, el sistema muestra el teclado virtual para que se introduzcan los datos.</p> <p>El <em>framework</em> no proporciona ningún método sencillo para forzar que se muestre o se oculte el teclado virtual, aunque podemos crearlo nosotros. Para ello se recomienda crear una clase de utilidad, llamada <code>SoftInputUtils</code>, que contenga los siguientes métodos estáticos:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SoftInputUtils</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>SoftInputUtils</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>showSoftInput</span><span class=p>(</span><span class=nd>@NonNull</span><span class=w> </span><span class=n>View</span><span class=w> </span><span class=n>view</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>view</span><span class=p>.</span><span class=na>requestFocus</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>            </span><span class=n>InputMethodManager</span><span class=w> </span><span class=n>imm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>InputMethodManager</span><span class=p>)</span><span class=w> </span><span class=n>view</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getSystemService</span><span class=p>(</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>                </span><span class=p>(</span><span class=n>Context</span><span class=p>.</span><span class=na>INPUT_METHOD_SERVICE</span><span class=p>));</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>imm</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>imm</span><span class=p>.</span><span class=na>showSoftInput</span><span class=p>(</span><span class=n>view</span><span class=p>,</span><span class=w> </span><span class=n>InputMethodManager</span><span class=p>.</span><span class=na>SHOW_IMPLICIT</span><span class=p>);</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>
<a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>hideSoftKeyboard</span><span class=p>(</span><span class=nd>@NonNull</span><span class=w> </span><span class=n>View</span><span class=w> </span><span class=n>view</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>        </span><span class=n>InputMethodManager</span><span class=w> </span><span class=n>imm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>InputMethodManager</span><span class=p>)</span><span class=w> </span><span class=n>view</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getSystemService</span><span class=p>(</span>
<a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w>            </span><span class=n>Context</span><span class=p>.</span><span class=na>INPUT_METHOD_SERVICE</span><span class=p>);</span>
<a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>imm</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>imm</span><span class=p>.</span><span class=na>hideSoftInputFromWindow</span><span class=p>(</span><span class=n>view</span><span class=p>.</span><span class=na>getWindowToken</span><span class=p>(),</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
<a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>
<a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a><span class=p>}</span>
</code></pre></div> <p>Por ejemplo, en nuestro Proyecto Login vamos a hacer que cuando el usuario pulsa el botón se oculte el teclado virtual, para que el <em>toast</em> de conexión no se muestre encima de él. Así modificaremos el código de nuestra actividad de la siguiente manera:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MainActivity</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AppCompatActivity</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=c1>// ...</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>btnLoginOnClick</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>getText</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>getText</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isValidForm</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>            </span><span class=n>SoftInputUtils</span><span class=p>.</span><span class=na>hideSoftKeyboard</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>);</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>            </span><span class=n>login</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>);</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=p>}</span>
</code></pre></div> <p>Al iniciar una actividad, el sistema pasa automáticamente el foco al primer <code>EditText</code> del <em>layout</em> o a aquel para el que se ha establecido la etiqueta <code>requestFocus</code>. Sin embargo, aunque le pase el foco, NO se mostrará el teclado virtual directamente.</p> <p>Si queremos que ya inicialmente se muestre el teclado virtual, tendremos que indicarlo explícitamente en el archivo de manifiesto <code>AndroidManfiest.xml</code>, a través del atributo <code>android:windowSoftInputMode="stateVisible"</code> de la etiqueta <code>activity</code> correspondiente a la actividad en cuestión.</p> <p>Por otra parte, debemos tener en cuenta que es posible que al mostrar el teclado virtual se oculte la vista sobre la que estamos escribiedo, atendiendo a su posición dentro de la interfaz de usuario.</p> <p>Para solucionarlo, Android nos proporciona una manera de indicar cómo debe adaptarse la interfaz de la actividad cuando la vista que ha hecho que se muestre el teclado virtual va a quedar oculta tras éste.</p> <p>Así, estableceremos en el mismo atributo anterior <code>android:windowSoftInputMode</code> a alguno de los siguientes valores:</p> <ul> <li><code>adjustResize</code>: El layout de la actividad se redimensiona al mostrar el teclado virtual.</li> <li><code>adjustPan</code>: El layout de la actividad es desplazado de manera que la vista que tiene el foco y que ha mostrado el teclado virtual no quede oculto tras éste.</li> </ul> <p>Si además de alguno de los valores anteriores queremos indicar el valor <code>stateVisible</code> deberemos usar el operador <code>or</code> de bits <code>|</code> para indicar varios valores. Así, en el siguiente ejemplo, se indican los valores <code>stateVisible</code> y <code>adjustPan</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nt>&lt;activity</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=err>&lt;!--</span><span class=w> </span><span class=err>...</span><span class=w> </span><span class=err>--</span><span class=nt>&gt;</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span>android:windowSoftInputMode=&quot;stateVisible|adjustPan&quot;<span class=w> </span>/&gt;
</code></pre></div> <p>Modifiquemos nuestro Proyecto Login de manera que en nuestra actividad se muestre directamente el teclado virtual cuando la vista <code>txtUsername</code> coja inicialmente el foco, y además la actividad sea desplazada hacia arriba automáticamente si el teclado virtual tapa al elemento que tiene el foco, aunque en realidad no haga falta con el diseño creado. Para ello actualizaremos el manifiesto de la aplicación, el archivo <code>AndroidManifest.xml</code> para incluir lo indicado anteriormente:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nt>&lt;manifest</span><span class=w> </span><span class=na>package=</span><span class=s>&quot;es.iessaladillo.pedrojoya.login&quot;</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>          </span><span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span><span class=nt>&lt;application</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>        </span><span class=na>android:allowBackup=</span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>        </span><span class=na>android:icon=</span><span class=s>&quot;@mipmap/ic_launcher&quot;</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>        </span><span class=na>android:label=</span><span class=s>&quot;@string/app_name&quot;</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>        </span><span class=na>android:roundIcon=</span><span class=s>&quot;@mipmap/ic_launcher_round&quot;</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>        </span><span class=na>android:supportsRtl=</span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>        </span><span class=na>android:theme=</span><span class=s>&quot;@style/AppTheme&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>        </span><span class=nt>&lt;activity</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>            </span><span class=na>android:name=</span><span class=s>&quot;.MainActivity&quot;</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>            </span><span class=na>android:windowSoftInputMode=</span><span class=s>&quot;stateVisible|adjustPan&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>            </span><span class=nt>&lt;intent-filter&gt;</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>                </span><span class=nt>&lt;action</span><span class=w> </span><span class=na>android:name=</span><span class=s>&quot;android.intent.action.MAIN&quot;</span><span class=nt>/&gt;</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>                </span><span class=nt>&lt;category</span><span class=w> </span><span class=na>android:name=</span><span class=s>&quot;android.intent.category.LAUNCHER&quot;</span><span class=nt>/&gt;</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>            </span><span class=nt>&lt;/intent-filter&gt;</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>        </span><span class=nt>&lt;/activity&gt;</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>    </span><span class=nt>&lt;/application&gt;</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=nt>&lt;/manifest&gt;</span>
</code></pre></div> <h2 id=imeoptions>ImeOptions<a class=headerlink href=#imeoptions title="Permanent link">&para;</a></h2> <p>Como hemos comentado en otra entrada, el valor del atributo <code>android:inputType</code> de un <code>EditText</code> determina qué teclas aparecerán en el teclado virtual cuando éste se muestre como consecuencia de que dicha vista haya obtenido el foco.</p> <figure> <p><img alt="Teclado virtual" src=../res/softkeyboard.png> <figcaption>Figura 19 - Teclado virtual</figcaption></p> </figure> <p>Pues bien, Android añade al teclado una tecla adicional con la acción que normalmente el usuario llevará a cabo cuando haya terminado de escribir su texto en el <code>EditText</code>. Dicha acción recibe el nombre de IME (<em>Input Method Editor</em>, editor de métodos de entrada) y por defecto es proporcionada por el sistema automáticamente, mostrando un icono distinto dependiendo de la acción de la que se trate.</p> <p>Sin embargo, podemos personalizar la acción a mostrar, estableciendo el atributo <code>android:imeOptions</code> de la vista a alguno de los siguientes valores:</p> <ul> <li><code>actionNext</code>: Ir a la siguiente vista en la que se pueden introducir datos. Si queremos configurar a qué vista podemos usar el atributo <code>android:nextFocusDown</code>.<img alt=img src=../res/imeactionnext.png></li> <li><code>actionPrevious</code>: Ir a la anterior vista en la que se pueden introducir datos. <img alt=img src=../res/imeactionprevious.png></li> <li><code>actionGo</code>: Ejecutar tarea que mostrará al usuario resultados. <img alt=img src=../res/imeactiongo.png></li> <li><code>actionSearch</code>: Buscar con el texto introducido. <img alt=img src=../res/imeactionsearch.png></li> <li><code>actionSend</code>: Enviar contenido que incluye el texto introducido. <img alt=img src=../res/imeactionsend.png></li> <li><code>actionDone</code>: Completar edición cerrando el teclado virtual. <img alt=img src=../res/imeactiondone.png></li> </ul> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Independientemente de que hayamos establecido una acción mediante el atributo <code>android:imeOptions</code>, si el <code>EditText</code> permite la introducción de varias líneas, la tecla IME siempre mostrará la acción de salto de línea, para permitir la introducción de varias líneas.</p> </div> <p>Podemos hacer la tecla IME en vez de mostrar un icono,muestre un texto personalizado, usando el atributo <code>android:imeActionLabel="texto"</code>.</p> <figure> <p><img alt="Atributos XML y métodos IME de EditText" src=../res/esquema16.svg> <figcaption>Figura 20 - Atributos XML y métodos IME de EditText</figcaption></p> </figure> <p>Otro aspecto importante es que tenemos la posibilidad de establecer un objeto <em>listener</em> para cuando el usuario pulse la tecla IME, de manera que podamos ejecutar una tarea asociada.</p> <p>Para tal fin asignaremos a la vista mediante el método <code>setOnEditorActionListener()</code> un objeto <em>listener</em> que implemente la interfaz <code>TextView.OnEditorActionListener</code>, de manera que cuando el usuario pulse la tecla IME se llamará al método <code>onEditorAction()</code> del <em>listener</em>, pasándole entre otros parámetros el <code>id</code> de la acción, que, si lo necesitamos, podremos comparar con alguna de las constantes de la clase <code>EditorInfo</code>, como por ejemplo <code>EditorInfo.IME_ACTION_DONE</code>. El método <code>onEditorAction()</code> debe retornar un booleano indicando si el evento ha sido consumido o no.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setOnEditorActionListener</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>TextView</span><span class=p>.</span><span class=na>OnEditorActionListener</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onEditorAction</span><span class=p>(</span><span class=n>TextView</span><span class=w> </span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>actionId</span><span class=p>,</span><span class=w> </span><span class=n>KeyEvent</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>        </span><span class=c1>// ...</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>        </span><span class=c1>// Retornamos true para indicar que el evento ha sido procesado </span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=p>});</span>
</code></pre></div> <p>Así, vamos a modificar nuestro Proyecto Login para que cuando se pulse sobre la tecla IME del teclado virtual cuando la vista <code>txtPassword</code> tenga el foco, directamente se trate de hacer login, como si se hubiera pulsado el botón <code>btnLogin</code>.</p> <p>Así, en la vista <code>txtPassword</code> de nuestro layout estableceremos el atributo <code>android:imeOptions</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nt>&lt;LinearLayout</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>    </span><span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=na>android:id=</span><span class=s>&quot;@+id/llRoot&quot;</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>    </span><span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=na>android:layout_height=</span><span class=s>&quot;match_parent&quot;</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>    </span><span class=na>android:orientation=</span><span class=s>&quot;vertical&quot;</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>    </span><span class=na>android:padding=</span><span class=s>&quot;@dimen/main_margin&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span><span class=cm>&lt;!-- ... --&gt;</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>    </span><span class=nt>&lt;EditText</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>        </span><span class=na>android:id=</span><span class=s>&quot;@+id/txtPassword&quot;</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>        </span><span class=na>android:layout_width=</span><span class=s>&quot;match_parent&quot;</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>        </span><span class=na>android:layout_height=</span><span class=s>&quot;wrap_content&quot;</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>        </span><span class=na>android:hint=</span><span class=s>&quot;@string/main_txtPassword&quot;</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>        </span><span class=na>android:imeOptions=</span><span class=s>&quot;actionDone&quot;</span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>        </span><span class=na>android:inputType=</span><span class=s>&quot;textPassword&quot;</span><span class=w> </span><span class=nt>/&gt;</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>
<a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>    </span><span class=cm>&lt;!-- ... --&gt;</span>
<a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>
<a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=nt>&lt;/LinearLayout&gt;</span>
</code></pre></div> <p>Nuestra actividad incorporaría el siguiente código:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MainActivity</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AppCompatActivity</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=c1>// ...</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setupViews</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>        </span><span class=c1>// ...</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>setOnEditorActionListener</span><span class=p>((</span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=n>actionId</span><span class=p>,</span><span class=w> </span><span class=n>event</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>            </span><span class=n>txtPasswordOnEditorAction</span><span class=p>());</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>txtPasswordOnEditorAction</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>        </span><span class=n>btnLoginOnClick</span><span class=p>();</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=p>}</span>
</code></pre></div> <h2 id=gestion-de-la-escritura>Gestión de la escritura<a class=headerlink href=#gestion-de-la-escritura title="Permanent link">&para;</a></h2> <p>En algunas ocasiones es necesario realizar alguna tarea justo en el momento en el que el usuario cambia el texto de un <code>EditText</code>, como por ejemplo para validar los datos en tiempo real conforme se escriben, o habilitar / deshabilitar algún botón dependiendo de si se ha escrito o no algo de texto en el <code>EditText</code>.</p> <p>Para tal fin deberemos crear un objeto <em>listener</em> de una clase que implemente la interfaz <code>TextWatcher</code> y asignárselo al <code>EditText</code> mediante el método <code>addTextChangedListener(textWatcher)</code>.</p> <figure> <p><img alt="Métodos de EditText relacionados con al escritura" src=../res/softkeyboard.png> <figcaption>Figura 21 - Métodos de EditText relacionados con al escritura</figcaption></p> </figure> <p>De esta manera, cada vez que el usuario modifique el texto del <code>EditText</code>, se llamará a alguno los siguientes métodos del <em>listener</em>:</p> <ul> <li><code>afterTextChanged()</code>: Se llama cuando el cambio ya ha sido realizado. Recibe el texto después del cambio.</li> <li><code>beforeTextChanged()</code>: Se llama antes de que se escriba el texto. Esto te permite saber el estado del texto actual y de la sección que será reemplazada.</li> <li><code>onTextChanged()</code>: Se llama cuando se ha reemplazado la sección del texto. Recibe qué porción del texto viejo se reemplazó y cuantos caracteres nuevos se agregaron.</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>addTextChangedListener</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>TextWatcher</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onTextChanged</span><span class=p>(</span><span class=n>CharSequence</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>                              </span><span class=kt>int</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>before</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>        </span><span class=c1>// ...</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>beforeTextChanged</span><span class=p>(</span><span class=n>CharSequence</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>                                  </span><span class=kt>int</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>after</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>        </span><span class=c1>// ...</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>afterTextChanged</span><span class=p>(</span><span class=n>Editable</span><span class=w> </span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>        </span><span class=c1>// ...</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=p>});</span>
</code></pre></div> <div class="admonition abstract"> <p class=admonition-title>Ten en cuenta</p> <p>La interfaz <code>TextWatcher</code> no es una interfaz funcional, ya que posee más de un método abstracto. Por este motivo, no podemos usar directamente una expresión lambda en vez de un objeto de una clase anónima inline.</p> </div> <p>Otro aspecto curioso es que el método para establecer el listener se llama <code>addTextChangedListener(textWatcher)</code>, y no <code>setTextChangedListener(textWatcher)</code>, lo cual es indicativo de que podemos tener más de un <em>listener</em> que sea notificado cuando cambie el texto del EditText.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Cuando se produce un cambio de configuración (como estudiaremos más adelante), el sistema preserva automáticamente el texto de los EditText, de manera que cuando la actividad vuelve a estar disponible, el sistema restaura automáticamente el texto de los EditText en el método <code>onRestoreInstanceState()</code>, que es ejecutado después del <code>onStart()</code> pero antes que el <code>onResume()</code>. Como consecuencia, si para ese momento ya hemos establecido un <code>TextWatcher</code> para la vista, su código será ejecutado.</p> <p>Por este motivo, a la hora de asociar a la vista correspondiente los <em>listener</em> que reaccionan a la entrada de datos, como <code>OnFocusChangeListener</code>, <code>TextWatcher</code> en los <em>EditText</em>, <code>OnCheckChangedListener</code> de <em>CheckBox</em>, o similares, debemos decidir si hacerlo en el método <code>onCreate()</code>, es decir, antes de que se restaure el estado automáticamente, o en el <code>onResume()</code>, es decir, después de que se restaure el estado automáticamente, dependiendo de si queramos que el evento correspondiente sea ejecutado tras la restauración o no. Si lo hacemos en el <code>onResume()</code>, entonces en el método <code>onPause()</code> deberemos quitar la asociación del <em>listener</em> con la vista, para lo que emplearemos el método <code>removeTextChangedListener(listener)</code> de la vista.</p> <p>Sin embargo, para los <em>listeners</em> cuyos eventos no pueden ser disparados durante la restauración automática, como por ejemplo <code>OnClickListener</code>, es seguro asignárselos a la vista en el método <code>onCreate()</code> de la actividad.</p> </div> <p>Modifiquemos el Proyecto Login para que se muestre un mensaje de error debajo de cada EditText obligatorio que no se haya introducido correctamente, en este caso si se deja vacío. En cuanto se introduzca texto el mensaje debe desaparecer. El código de la actividad quedaría de la siguiente manera:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MainActivity</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AppCompatActivity</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>    </span><span class=c1>// ...</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>TextWatcher</span><span class=w> </span><span class=n>txtUsernameTextWatcher</span><span class=p>;</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>TextWatcher</span><span class=w> </span><span class=n>txtPasswordTextWatcher</span><span class=p>;</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onStart</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onStart</span><span class=p>();</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>(</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>            </span><span class=p>(</span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>changeColor</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=na>lblUsername</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>));</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>(</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>            </span><span class=p>(</span><span class=n>v</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>changeColor</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=na>lblPassword</span><span class=p>,</span><span class=w> </span><span class=n>hasFocus</span><span class=p>));</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>        </span><span class=n>txtUsernameTextWatcher</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TextWatcher</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>            </span><span class=nd>@Override</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>beforeTextChanged</span><span class=p>(</span><span class=n>CharSequence</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>after</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>            </span><span class=nd>@Override</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onTextChanged</span><span class=p>(</span><span class=n>CharSequence</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>before</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=w>            </span><span class=nd>@Override</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>afterTextChanged</span><span class=p>(</span><span class=n>Editable</span><span class=w> </span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=w>                </span><span class=n>validateUsername</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=w>        </span><span class=p>};</span>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>addTextChangedListener</span><span class=p>(</span><span class=n>txtUsernameTextWatcher</span><span class=p>);</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=w>        </span><span class=n>txtPasswordTextWatcher</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TextWatcher</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=w>            </span><span class=nd>@Override</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>beforeTextChanged</span><span class=p>(</span><span class=n>CharSequence</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>after</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a>
<a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a><span class=w>            </span><span class=nd>@Override</span>
<a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onTextChanged</span><span class=p>(</span><span class=n>CharSequence</span><span class=w> </span><span class=n>s</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>start</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>before</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>count</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a>
<a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a><span class=w>            </span><span class=nd>@Override</span>
<a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a><span class=w>            </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>afterTextChanged</span><span class=p>(</span><span class=n>Editable</span><span class=w> </span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-40 name=__codelineno-12-40 href=#__codelineno-12-40></a><span class=w>                </span><span class=n>validatePassword</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span>
<a id=__codelineno-12-41 name=__codelineno-12-41 href=#__codelineno-12-41></a><span class=w>            </span><span class=p>}</span>
<a id=__codelineno-12-42 name=__codelineno-12-42 href=#__codelineno-12-42></a><span class=w>        </span><span class=p>};</span>
<a id=__codelineno-12-43 name=__codelineno-12-43 href=#__codelineno-12-43></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>addTextChangedListener</span><span class=p>(</span><span class=n>txtPasswordTextWatcher</span><span class=p>);</span>
<a id=__codelineno-12-44 name=__codelineno-12-44 href=#__codelineno-12-44></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-45 name=__codelineno-12-45 href=#__codelineno-12-45></a>
<a id=__codelineno-12-46 name=__codelineno-12-46 href=#__codelineno-12-46></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-12-47 name=__codelineno-12-47 href=#__codelineno-12-47></a><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onStop</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-48 name=__codelineno-12-48 href=#__codelineno-12-48></a><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onStop</span><span class=p>();</span>
<a id=__codelineno-12-49 name=__codelineno-12-49 href=#__codelineno-12-49></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a id=__codelineno-12-50 name=__codelineno-12-50 href=#__codelineno-12-50></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>setOnFocusChangeListener</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a id=__codelineno-12-51 name=__codelineno-12-51 href=#__codelineno-12-51></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>removeTextChangedListener</span><span class=p>(</span><span class=n>txtUsernameTextWatcher</span><span class=p>);</span>
<a id=__codelineno-12-52 name=__codelineno-12-52 href=#__codelineno-12-52></a><span class=w>        </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>removeTextChangedListener</span><span class=p>(</span><span class=n>txtPasswordTextWatcher</span><span class=p>);</span>
<a id=__codelineno-12-53 name=__codelineno-12-53 href=#__codelineno-12-53></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-54 name=__codelineno-12-54 href=#__codelineno-12-54></a>
<a id=__codelineno-12-55 name=__codelineno-12-55 href=#__codelineno-12-55></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>validateUsername</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-56 name=__codelineno-12-56 href=#__codelineno-12-56></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isValidUserName</span><span class=p>(</span><span class=n>username</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-57 name=__codelineno-12-57 href=#__codelineno-12-57></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setError</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a id=__codelineno-12-58 name=__codelineno-12-58 href=#__codelineno-12-58></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-12-59 name=__codelineno-12-59 href=#__codelineno-12-59></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-60 name=__codelineno-12-60 href=#__codelineno-12-60></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>setError</span><span class=p>(</span><span class=n>getString</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>string</span><span class=p>.</span><span class=na>main_required</span><span class=p>));</span>
<a id=__codelineno-12-61 name=__codelineno-12-61 href=#__codelineno-12-61></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-12-62 name=__codelineno-12-62 href=#__codelineno-12-62></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-12-63 name=__codelineno-12-63 href=#__codelineno-12-63></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-64 name=__codelineno-12-64 href=#__codelineno-12-64></a>
<a id=__codelineno-12-65 name=__codelineno-12-65 href=#__codelineno-12-65></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>validatePassword</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-66 name=__codelineno-12-66 href=#__codelineno-12-66></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isValidPassword</span><span class=p>(</span><span class=n>password</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-67 name=__codelineno-12-67 href=#__codelineno-12-67></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>setError</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<a id=__codelineno-12-68 name=__codelineno-12-68 href=#__codelineno-12-68></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-12-69 name=__codelineno-12-69 href=#__codelineno-12-69></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-70 name=__codelineno-12-70 href=#__codelineno-12-70></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>setError</span><span class=p>(</span><span class=n>getString</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=na>string</span><span class=p>.</span><span class=na>main_required</span><span class=p>));</span>
<a id=__codelineno-12-71 name=__codelineno-12-71 href=#__codelineno-12-71></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-12-72 name=__codelineno-12-72 href=#__codelineno-12-72></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-12-73 name=__codelineno-12-73 href=#__codelineno-12-73></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-74 name=__codelineno-12-74 href=#__codelineno-12-74></a>
<a id=__codelineno-12-75 name=__codelineno-12-75 href=#__codelineno-12-75></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isValidForm</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-76 name=__codelineno-12-76 href=#__codelineno-12-76></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>validateUsername</span><span class=p>(</span><span class=n>username</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-77 name=__codelineno-12-77 href=#__codelineno-12-77></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtUsername</span><span class=p>.</span><span class=na>requestFocus</span><span class=p>();</span>
<a id=__codelineno-12-78 name=__codelineno-12-78 href=#__codelineno-12-78></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-12-79 name=__codelineno-12-79 href=#__codelineno-12-79></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-12-80 name=__codelineno-12-80 href=#__codelineno-12-80></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>validatePassword</span><span class=p>(</span><span class=n>password</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-81 name=__codelineno-12-81 href=#__codelineno-12-81></a><span class=w>            </span><span class=n>binding</span><span class=p>.</span><span class=na>txtPassword</span><span class=p>.</span><span class=na>requestFocus</span><span class=p>();</span>
<a id=__codelineno-12-82 name=__codelineno-12-82 href=#__codelineno-12-82></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<a id=__codelineno-12-83 name=__codelineno-12-83 href=#__codelineno-12-83></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-12-84 name=__codelineno-12-84 href=#__codelineno-12-84></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<a id=__codelineno-12-85 name=__codelineno-12-85 href=#__codelineno-12-85></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-12-86 name=__codelineno-12-86 href=#__codelineno-12-86></a>
<a id=__codelineno-12-87 name=__codelineno-12-87 href=#__codelineno-12-87></a><span class=p>}</span>
</code></pre></div> <p>También tendremos que añadir el siguiente recurso de cadena al archivo <code>res/values/strings.xml</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nt>&lt;string</span><span class=w> </span><span class=na>name=</span><span class=s>&quot;main_required&quot;</span><span class=nt>&gt;</span>Required<span class=nt>&lt;/string&gt;</span>
</code></pre></div> <h2 id=fijar-la-orientacion-de-la-actividad>Fijar la orientación de la actividad<a class=headerlink href=#fijar-la-orientacion-de-la-actividad title="Permanent link">&para;</a></h2> <p>En este proyecto (y en los anteriores) ni siquiera nos hemos preguntado qué pasaría si giráramos la pantalla del dispositivo. Para empezar, nuestro <em>layout</em> no se vería correctamente en una orientación apaisada (<em>landscape</em>). Por este motivo, y hasta que sepamos cómo gestionar correctamente los cambios de configuración, vamos a optar por fijar la orientación de la actividad en el modo retrato (<em>portrait</em>).</p> <p>Para ello en la declaración de la actividad en el manifiesto de la aplicación, esto es, en el archivo <code>AndroidManifest.xml</code>, estableceremos el atributo <code>android:screenOrientation</code> al valor <code>portrait</code>. Para el modo apaisado el valor es <code>landscape</code>.</p> <p>Así, el manifiesto de nuestro Proyecto Login quedaría:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nt>&lt;manifest</span><span class=w> </span><span class=na>package=</span><span class=s>&quot;es.iessaladillo.pedrojoya.login&quot;</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=w>          </span><span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>    </span><span class=nt>&lt;application</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>        </span><span class=na>android:allowBackup=</span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>        </span><span class=na>android:icon=</span><span class=s>&quot;@mipmap/ic_launcher&quot;</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>        </span><span class=na>android:label=</span><span class=s>&quot;@string/app_name&quot;</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>        </span><span class=na>android:roundIcon=</span><span class=s>&quot;@mipmap/ic_launcher_round&quot;</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>        </span><span class=na>android:supportsRtl=</span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>        </span><span class=na>android:theme=</span><span class=s>&quot;@style/AppTheme&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>        </span><span class=nt>&lt;activity</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>            </span><span class=na>android:name=</span><span class=s>&quot;.MainActivity&quot;</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>            </span><span class=na>android:windowSoftInputMode=</span><span class=s>&quot;stateVisible|adjustPan&quot;</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>            </span><span class=na>android:screenOrientation=</span><span class=s>&quot;portrait&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=w>            </span><span class=nt>&lt;intent-filter&gt;</span>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>                </span><span class=nt>&lt;action</span><span class=w> </span><span class=na>android:name=</span><span class=s>&quot;android.intent.action.MAIN&quot;</span><span class=nt>/&gt;</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=w>                </span><span class=nt>&lt;category</span><span class=w> </span><span class=na>android:name=</span><span class=s>&quot;android.intent.category.LAUNCHER&quot;</span><span class=nt>/&gt;</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>            </span><span class=nt>&lt;/intent-filter&gt;</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>        </span><span class=nt>&lt;/activity&gt;</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>    </span><span class=nt>&lt;/application&gt;</span>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=nt>&lt;/manifest&gt;</span>
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../page-5/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 5 Entorno de Android" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 5 Entorno de Android </div> </div> </a> <a href=../page-7/ class="md-footer__link md-footer__link--next" aria-label="Next: Proyecto TIME" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Proyecto TIME </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - 2024 irubenboy </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/squidfunk/mkdocs-material target=_blank rel=noopener title=gitter.im class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://pypi.org/project/mkdocs-material/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> </a> <a href=https://twitter.com/squidfunk target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>